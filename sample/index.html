<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Optimize Proxy 샘플</title>
  <style>
    :root { color-scheme: light; }
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 0; padding: 32px; line-height: 1.6; }
    main { max-width: 960px; margin: 0 auto; display: grid; gap: 24px; }
    section { border: 1px solid #d0d7de; border-radius: 12px; padding: 20px; background: rgba(255, 255, 255, 0.85); }
    h1, h2 { margin-top: 0; }
    code { background: #f6f8fa; padding: 2px 6px; border-radius: 4px; }
    pre { background: #a1a1a1; color: #5d5d5d; padding: 16px; border-radius: 8px; overflow-x: auto; }
    .grid { display: grid; gap: 24px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); align-items: start; }
    figure { margin: 0; display: grid; gap: 8px; }
    img { width: 100%; height: auto; border-radius: 12px; border: 1px solid #d0d7de; background: #fff; }
    figcaption { font-size: 0.9rem; color: #57606a; }
  </style>
</head>
<body>
  <main>
    <header>
      <h1>Image Optimize Proxy 데모</h1>
      <p>
        `npm start`로 프록시 서버를 띄운 뒤 이 페이지를 열면 모든 `<img>` 태그가 자동으로
        `http://localhost:3000/?u=...` 형식으로 재작성되어 WebP로 응답합니다.
      </p>
      <p>
        다른 도메인에서 테스트하려면 <code>sample/proxy-loader.js</code>의 <code>PROXY_BASE_URL</code> 값을 수정하거나,
        전역 변수 <code>window.PROXY_BASE_URL</code>을 이 페이지에서 미리 정의하세요.
      </p>
    </header>

    <section>
      <h2>페이지 사용 방법</h2>
      <ol>
        <li>레포 루트에서 <code>npm install</code> & <code>npm start</code> 실행</li>
        <li>이 HTML을 브라우저에서 열기 (정적 파일이라 더블클릭으로 충분)</li>
        <li>개발자 도구 네트워크 탭에서 <code>X-Cache</code> 헤더와 WebP 응답을 확인</li>
      </ol>
      <p>
        이미지 태그마다 <code>data-origin</code>, <code>data-width</code>, <code>data-height</code>, <code>data-referer</code>를 설정하면
        프록시 요청 파라미터(<code>u</code>, <code>w</code>, <code>h</code>, <code>ref</code>)로 자동 변환됩니다.
      </p>
    </section>

    <section class="grid">
      <figure>
        <img
                alt="GIF optimized to 400px"
                src="https://localhost:3000/?w=400&u=https://cafe24img.poxo.com/motherkmall/web/product/medium/202509/2a8ed7031b7fb39fb2ea605359148358.gif"
        />
        <figcaption>허용 도메인 GIF (400px 최대 폭)</figcaption>
      </figure>
      <figure>
        <img
          alt="Same GIF optimized to 250px height"
          src="https://localhost:3000/?w=250&u=https://cafe24img.poxo.com/motherkmall/web/product/medium/202509/2a8ed7031b7fb39fb2ea605359148358.gif"
          data-height="250"
        />
        <figcaption>같은 원본, 높이 250px 제한</figcaption>
      </figure>
      <figure>
        <img
          alt="Blocked origin example"
          src="https://localhost:3000/?w=400&u=https://cafe24img.poxo1.com/motherkmall/web/product/medium/202509/2a8ed7031b7fb39fb2ea605359148358.gif"
        />
        <figcaption>허용되지 않은 도메인 (HTTP 400을 의도적으로 확인)</figcaption>
      </figure>
    </section>

    <section>
      <h2>직접 URL 테스트</h2>
      <pre><code>curl -I "http://localhost:3000/?u=https://cafe24img.poxo.com/motherkmall/web/product/medium/202509/2a8ed7031b7fb39fb2ea605359148358.gif&amp;w=600"</code></pre>
      <p>
        응답 헤더의 <code>Content-Type: image/webp</code>, <code>Cache-Control</code>, <code>X-Cache</code> 값을 확인해 보세요.
      </p>
    </section>
  </main>
  <script src="./proxy-loader.js"></script>
</body>
</html>
